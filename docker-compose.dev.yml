services:
    postgres:
        container_name: mic-edu-journal-postgres
        image: postgres:latest
        restart: unless-stopped
        environment:
            - POSTGRES_USER=mic-edu-journal
            - POSTGRES_PASSWORD=fd5b47ab8081ef9597d371de
            - POSTGRES_DB=mic-edu-journal
        ports:
            - 5432:5432
        volumes:
            - postgres_data:/var/lib/postgresql/data
    redis:
        container_name: mic-edu-journal-redis
        image: redis:latest
        command: ["redis-server", "--maxmemory-policy", "noeviction"]
        restart: unless-stopped
        ports:
            - 6379:6379
        volumes:
            - redis_data:/data
    minio:
        container_name: mic-edu-journal-minio
        image: minio/minio:latest
        command: ["minio", "server", "/data", "--console-address", ":9001"]
        restart: unless-stopped
        environment:
            - MINIO_ACCESS_KEY=mic-edu-journal
            - MINIO_SECRET_KEY=fd5b47ab8081ef9597d371de
        volumes:
            - minio_data:/data
        healthcheck:
            test: ["CMD", "mc", "ready", "local"]
            interval: 5s
            timeout: 5s
            retries: 5

    dbgate:
        container_name: mic-edu-journal-dbgate
        image: dbgate/dbgate
        restart: unless-stopped
        volumes:
            - dbgate-data:/root/.dbgate
        ports:
            - 5666:3000
        environment:
            LOGIN: admin
            PASSWORD: admin
            CONNECTIONS: postgres

            LABEL_postgres: Postgres
            SERVER_postgres: postgres
            USER_postgres: mic-edu-journal
            DATABASE_postgres: mic-edu-journal
            PASSWORD_postgres: fd5b47ab8081ef9597d371de
            PORT_postgres: 5432
            ENGINE_postgres: postgres@dbgate-plugin-postgres
volumes:
    postgres_data:
    redis_data:
    minio_data:
    dbgate-data:

networks:
    default: {}
